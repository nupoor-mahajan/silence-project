<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Civic Silence Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=JetBrains+Mono:wght@400;500&family=Merriweather:wght@700&display=swap" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

    <header class="civic-header">
        <div class="container">
            <h1>Silence Monitor</h1>
            <p class="subtitle">Governance Listening Tool // <span class="accent-text">Make the unheard visible</span></p>
        </div>
    </header>

    <main class="container grid-layout">
        
        <section class="card input-panel">
            <h2>Data Ingestion</h2>
            <p class="instruction">Upload CSV containing: region, district, population, complaints, history_avg.</p>
            <form method="post" enctype="multipart/form-data" class="civic-form">
                {% csrf_token %}
                <div class="form-group">
                    {{ form.dataset.label_tag }}
                    {{ form.dataset }}
                </div>
                <div class="form-group">
                    {{ form.silence_threshold.label_tag }}
                    {{ form.silence_threshold }}
                    <small>Set anomaly sensitivity (Default: 0.5)</small>
                </div>
                <button type="submit" class="btn-civic">Run Analysis Pipeline</button>
            </form>
        </section>

        {% if results %}
        <section class="card stats-panel">
            <h2>Dataset Metrics</h2>
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="label">Mean Density</span>
                    <span class="value">{{ results.stats.mean }}</span>
                </div>
                <div class="stat-item">
                    <span class="label">Median Density</span>
                    <span class="value">{{ results.stats.median }}</span>
                </div>
                <div class="stat-item">
                    <span class="label">Flagged Zones</span>
                    <span class="value highlight">{{ results.stats.flagged_count }}</span>
                </div>
            </div>
            <div class="disclaimer">
                <strong>Cautious Labeling:</strong> Low complaints do not guarantee peace. 
                Correlate with field reports to rule out suppression or access barriers.
            </div>
        </section>

        <section class="card map-panel fade-in">
            <h2>Silence Map Visualization</h2>
            <div class="chart-container">
                <img src="data:image/png;base64,{{ results.chart }}" alt="Silence Map Chart">
            </div>
        </section>

        <section class="card rank-panel">
            <h2>Flagged "Silent" Regions</h2>
            <p class="instruction">Ranked by severity (lowest density first). Monitor for under-reporting.</p>
            
            <div class="console-output">
                <div class="console-header">
                    <span>REGION ID</span>
                    <span>DISTRICT</span>
                    <span>DENSITY</span>
                    <span>FEAR INDICATOR</span>
                </div>
                {% for region in results.ranked_regions %}
                <div class="console-row pulse-marker">
                    <span class="mono">{{ region.region }}</span>
                    <span>{{ region.district }}</span>
                    <span class="mono">{{ region.density|floatformat:2 }}</span>
                    <span class="mono warning">
                        {% if region.fear_score > 0 %}
                           ⚠️ TREND GAP
                        {% else %}
                           LOW SIGNAL
                        {% endif %}
                    </span>
                </div>
                {% empty %}
                <div class="console-row">No silent regions detected at this threshold.</div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

    </main>
</body>
</html>